<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:tal="http://xml.zope.org/namespaces/tal"
     xmlns:i18n="http://xml.zope.org/namespaces/i18n"
     i18n:domain="gs.group.messages.post"
     role="article"
     tal:define="m python:modules['Products.XWFCore.XWFUtils'];
                 munge_date python:m.munge_date;
                 change_tz python:m.change_timezone;"
     tal:attributes="class string:hentry ${view/cssClass};
                     id string:post-${view/post/post_id};
                     aria-labelledby string:post-${view/post/post_id}-title">
  <div class="email-metadata" role="complementary">
    <strong class="author vcard">
      <a class="fn url"
         tal:omit-tag="view/authorInfo/anonymous"
         tal:attributes="href view/authorInfo/url;
                         title string:Profile of ${view/authorInfo/name};"
         tal:content="view/authorInfo/name">Me!</a>
    </strong><!--vcard-->
    <a class="topic entry-title" role="heading" rel="bookmark"
       aria-hidden="true"
       tal:attributes="id string:post-${view/post/post_id}-title;
                       href string:/r/post/${view/post/post_id};"
       tal:content="view/topicName">A Topic</a>
    <span class="posted muted small"
          tal:define="pd view/post/date;
                      d python:change_tz(pd, 'UTC').replace(microsecond=0);
                      date python:munge_date(view.context, pd)"
          i18n:translate="post-date">
      Posted at
      <em i18n:name="dateTime"
          class="date updated published">
        <time tal:attributes="datetime d/isoformat"
              tal:content="date">Today, Tomorrow, Timaru</time></em>
    </span><!--posted-->
    <div class="gs-group-messages-post-buttons btn-toolbar"
         role="toolbar" aria-label="Post Actions"
         tal:condition="not:view/post/hidden">
      <a class="gs-content-js-share btn btn-small" role="button"
         aria-haspopup="true" data-icon="&#xe001;"
         tal:attributes="href string:${view/siteInfo/url}/r/post/${view/post/post_id};
                         title string:${view/post/subject};
                         public python:view.isPublic and 1 or 0"
         i18n:translate="share-button">Share</a>
      <button class="hide-button btn btn-small" role="button" title="Hide"
              aria-haspopup="true" tal:condition="view/canHide">
        <div class="icon-alone">
          <span aria-hidden="true" data-icon="&#x1f5d1;"></span>
          <span class="screen-reader-text"
                i18n:translate="hide-button">Hide</span>
        </div>
      </button>
    </div><!--gs-group-messages-post-buttons-->
  </div><!--email-metadata-->
  <div tal:condition="view/showPhoto" role="complementary"
       tal:define="user view/authorInfo/user; size string:50;"
       tal:replace="structure provider:groupserver.SquareUserImage"/>
  <div tal:condition="view/post/hidden"
       tal:define="dshId string:post-${view/post/post_id}-dsh"
       class="disclosureWidget hidden-post">
    <p class="muted">
      <a class="disclosureButton" href="#" role="button"
         tal:attributes="aria-controls dshId">Hidden</a>
    </p>
    <div tal:attributes="id dshId"
         class="hidden-msg disclosureShowHide" style="display:none;">
      <p class="vcard" i18n:translate="hidden-post">
        Sorry, this post is hidden.
        The reason that
        <a class="fn" href="#" i18n:name="theAuthor"
           tal:define="u view/hiddenPostInfo/adminInfo"
           tal:attributes="href u/url"
           tal:content="u/name">an admin</a>
        gave for hiding the post is as follows.
      </p><!--vcard-->
      <blockquote>
        <p tal:content="view/hiddenPostInfo/reason">
          Too many turtles.
        </p>
      </blockquote>
      <p>
        If you think you should be able to see the post
        <a href="#"
           tal:attributes="href view/hiddenSupportEmail"
           class="email">email support</a>
        and we will see what we can do to help.
      </p>
    </div><!--hidden-msg-->
  </div><!--hidden-post-->
  <div tal:condition="not:view/post/hidden" class="email-message">
    <pre class="entry-content"
         tal:content="structure view/postIntro">
      This is the body of the document.
    </pre><!--entry-content-->
    <div class="email-remainder muted disclosureWidget"
         tal:condition="python:view.postRemainder.strip()"
         tal:define="remId string:emailRemainder${view/post/post_id};
                     discloseId string:emailDiscloseButton${view/post/post_id};
                     dshId string:${remId}-text"
         tal:attributes="id remId">
      <p class="small">
        <a class="disclosureButton" role="button"
           tal:attributes="aria-controls dshId;"
           href="#"
           i18n:translate="rest-of-post-button">Rest of post</a>
      </p>
      <div class="disclosureShowHide" style="display:none;"
           tal:define="show string:display:block;
                       hide string:display:none"
           tal:attributes="id dshId;
                           style python:show if view.showRemainder else hide;">
        <pre tal:content="structure view/postRemainder">
          This is the remainder of the email, with such things as
          the footer.
        </pre>
      </div><!--disclosureShowHide-->
    </div><!--email-remainder-->
    <div class="fileNotification" role="list"
         tal:condition="view/post/files_metadata">
      <div class="normalFileList" tal:condition="view/normalFiles">
        <div class="info hmedia" tal:repeat="fm view/normalFiles"
             role="listitem" tal:attributes="id fm/file_id">
          <a class="icon-alone" href="#"
             tal:attributes="href fm/url; title fm/file_name;
                             type fm/mime_type">
            <span aria-hidden="true" data-icon="&#x1f3a8;"
                  tal:attributes="data-icon fm/icon"></span>
            <span class="screen-reader-text"
                  i18n:translate="file-type">File type:
              <span i18n:name="mimeType"
                    tal:content="fm/mime_type">application/octet-stream</span>
            </span>
          </a>
          <a class="enclosure" type="application/octet-stream"
             tal:attributes="type fm/mime_type; href fm/url; title fm/file_name"
             href="#">
            <span class="fn" tal:content="fm/file_name">Filename</span>
            <span class="size muted"
                  tal:attributes="title string:${fm/file_size}B"
                  tal:content="fm/size">-1</span>
          </a>
        </div><!--info-->
      </div><!--normalFileList-->
      <div class="mediaFileList" tal:condition="view/mediaFiles">
        <div tal:repeat="fm view/mediaFiles"
             class="hmedia" role="listitem img"
             tal:attributes="id fm/file_id">
          <a href="#" class="thumb"
             tal:attributes="href fm/url"
             tal:define="fileId fm/file_id;
                         alt string:The posted image ${fm/file_name};
                         width string:190; height string:190">
            <span tal:replace="structure provider:groupserver.GroupImage">
              The image itself.
            </span>
          </a><!--thumb-->
          <div class="info small">
            <a class="enclosure" type="application/octet-stream"
               tal:attributes="type fm/mime_type;
                               href fm/url;"
               href="#"><span class="fn"
                              tal:content="fm/file_name">Filename</span>
            <span class="muted"
                  tal:attributes="title string:${fm/file_size}B"
                  tal:content="fm/size">-1</span></a>
          </div><!--info-->
        </div><!--hmedia-->
      </div><!--mediaFileList-->
    </div><!--fileNotification-->
  </div><!--email-message-->
</div><!--hentry-->
